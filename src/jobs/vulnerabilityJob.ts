import { CronJob } from "cron";
import { fetchVulnerabilities } from "../services/nvdService";
import { sendVulnerabilityMessage } from "../services/slackService";
import { config } from "../config/config";
import { secondsToCron } from "../utils/helpers";

// Defining the job to run periodically
export const vulnerabilityJob = new CronJob(
  secondsToCron(config.scanInterval),
  async () => {
    let vulnerabilities = await fetchVulnerabilities();
    if (vulnerabilities.length) {
      vulnerabilities.forEach((vulnerability: any) => {
        sendVulnerabilityMessage(vulnerability, config.adminId);
      });
    }
  }
);
