import { CronJob } from "cron";
import { fetchVulnerabilities } from "../services/nvdService";
import { sendVulnerabilityMessage } from "../services/slackService";
import { config } from "../config/config";

// Define the job to run periodically
export const vulnerabilityJob = new CronJob("*/10 * * * * *", async () => {
  let vulnerabilities = await fetchVulnerabilities();
  vulnerabilities = [vulnerabilities[0]]; //TODO change
  if (vulnerabilities.length) {
    // TODO analyze all the vulnerabilities for different type of descriptions
    vulnerabilities.forEach((vulnerability: any) => {
      sendVulnerabilityMessage(vulnerability, config.adminId);
    });
  }
});

vulnerabilityJob.start();
